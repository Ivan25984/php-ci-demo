# Упрощенный .gitlab-ci.yml
stages:
  - test

# Тест на PHP 8.2
test:php82:
  stage: test
  image: php:8.2-cli
  before_script:
    # Обновляем и устанавливаем минимальные пакеты
    - apt-get update && apt-get install -y git unzip
    # Устанавливаем Composer
    - curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer
    # Устанавливаем зависимости проекта
    - composer install --no-progress --no-suggest
  script:
    - echo "=== Тестируем на PHP 8.2 ==="
    - php -v
    - ./vendor/bin/phpunit --colors=never

# Тест на PHP 8.3
test:php83:
  stage: test
  image: php:8.3-cli
  before_script:
    - apt-get update && apt-get install -y git unzip
    - curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer
    - composer install --no-progress --no-suggest
  script:
    - echo "=== Тестируем на PHP 8.3 ==="
    - php -v
    - ./vendor/bin/phpunit --colors=never

# Тест на PHP 8.4
test:php84:
  stage: test
  image: php:8.4-cli
  before_script:
    - apt-get update && apt-get install -y git unzip
    - curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer
    - composer install --no-progress --no-suggest
  script:
    - echo "=== Тестируем на PHP 8.4 ==="
    - php -v
    - ./vendor/bin/phpunit --colors=never

# Простая проверка
check:
  stage: test
  image: php:8.3-cli
  script:
    - echo "Проверка работоспособности..."
    - php -r "echo 'PHP работает! ' . PHP_VERSION;"
